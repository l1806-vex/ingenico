#*******************************************************************************
#* %MAKEFILE_FILE_NAME%
#*------------------------------------------------------------------------------
#* Makefile used to generate the module DLL (GNU WIN32 format).
#* This file was automatically generated by IngeDev. Please, do not edit!
#*******************************************************************************

#-------------------------------------------------------------------------------
# Include variables list set in the runtime-workspace - updated by IngeDev
#-------------------------------------------------------------------------------
include vars.mk
include %OS_VARS_MK_FILE%

#-------------------------------------------------------------------------------
# Include variables list set for all projects used for linked libraries 
# and added common modules - updated by IngeDev
#-------------------------------------------------------------------------------
%PROJECTS_VARS_MK_FILE%
#-------------------------------------------------------------------------------
# Include added common modules makefiles - updated by IngeDev
#-------------------------------------------------------------------------------
%ADDED_COM_MOD_MK_FILES%
#-------------------------------------------------------------------------------
# General constants
#-------------------------------------------------------------------------------
EMPTY :=
SPACE := $(EMPTY) $(EMPTY)

#-------------------------------------------------------------------------------
# Project and file names - updated by IngeDev
#-------------------------------------------------------------------------------
# Project name
PROJECT_NAME    = %PROJECT_NAME%
# Sub-Project name
SUB_PRJ_NAME    = %SUB_PROJECT_NAME%
# Configuration name
CFG_NAME        = %CONFIG_NAME%
# Target file name
TRG_FILE_NAME   = %TARGET_FILE_NAME%.dll
# U32 simulation library file name
U32_SIMU_LIB_FILE_NAME= %U32_SIMU_LIB_FILE_NAME%

#-------------------------------------------------------------------------------
# Directories - updated by IngeDev
#-------------------------------------------------------------------------------
# Binaries directory
BIN_DIR         = %BIN_DIR%
# Object directory
OBJ_DIR         = %OBJ_DIR%

#-------------------------------------------------------------------------------
# Input files path for the current sub-project in the current configuration
#-------------------------------------------------------------------------------
# Sub-project configuration path
CFG_PATH        = $(SUB_PRJ_NAME)/$(CFG_NAME)

#-------------------------------------------------------------------------------
# Output files path for the current sub-project in the current configuration
#-------------------------------------------------------------------------------
# Object files path
OBJ_PATH        = $(OBJ_DIR)/$(SUB_PRJ_NAME)/$(CFG_NAME)
# Binary files path
BIN_PATH        = $(BIN_DIR)/$(CFG_NAME)

#-------------------------------------------------------------------------------
# Include additional makefiles
#-------------------------------------------------------------------------------
%ADDITIONAL_MK_FILES%

#-------------------------------------------------------------------------------
# Compiler, linker, assembler
#-------------------------------------------------------------------------------
# Gnu Win32 Compiler executable
CC              = gcc.exe
# Gnu Win32 Assembler executable
AS              = as.exe
# Gnu Win32 debug symbol executable
STRIP           = strip.exe -g

#-------------------------------------------------------------------------------
# Gnu Win32 tools
#-------------------------------------------------------------------------------
# Remove tool
RM              = rm.exe -fr
# Make directory tool
MKDIR           = mkdir.exe -p
# Copy tool
CP              = cp.exe
# Printf tool
PRINTF          = printf.exe

#-------------------------------------------------------------------------------
# Includes path used in compilation process - updated by IngeDev
#-------------------------------------------------------------------------------
INCLUDES_PATH   = \
%USER_INCLUDES_PATH%
<<if systemIncludesWithLowPriority
$(GNU_WIN32_SYS_INC_PATH_LOW_PRIORITY)
<<else
$(GNU_WIN32_SYS_INC_PATH)
<<endif

#-------------------------------------------------------------------------------
# Libraries to be included during link operation - updated by IngeDev
#-------------------------------------------------------------------------------
LIBS            = \
<<if linkInterModuleLibBeforeUserLibs
$(OBJ_DIR)/InterModuleLib/$(CFG_NAME)/InterModuleLib.lib \
<<endif
%ADDITIONAL_LINKED_LIBS%
%ADDITIONAL_SYST_LIBS%
<<if linkInterModuleLibAfterUserLibs
$(OBJ_DIR)/InterModuleLib/$(CFG_NAME)/InterModuleLib.lib \
<<endif

<<if IngeDev5Format
LIBS           += $(SIMULATION_SYS_LIB_PATH)/SimeliteIng6.lib
<<else
LIBS           += $(SIMULATION_SYS_LIB_PATH)/$(U32_SIMU_LIB_FILE_NAME)
<<endif
LIBS           += $(GNUWIN32_LIB_PATH)/libsupc++.a

#-------------------------------------------------------------------------------
# DLL result output file - updated by IngeDev
#-------------------------------------------------------------------------------
DLL_FILE        = $(BIN_PATH)/$(TRG_FILE_NAME)

#-------------------------------------------------------------------------------
# Default compiler, linker, assembler options - updated by IngeDev
#-------------------------------------------------------------------------------
# Default compiler options
CC_DEF_OPTS     = %DEFAULT_CC_OPTIONS%

# Default assembler options
AS_DEF_OPTS     = %DEFAULT_AS_OPTIONS%

# Default compiler options for link process (DLL creation)
CC_LD_DEF_OPTS  = %DEFAULT_CC_LD_OPTIONS%

#-------------------------------------------------------------------------------
# Specific compiler, linker, assembler options - updated by IngeDev
#-------------------------------------------------------------------------------
# Compiler options
CC_SPEC_OPTS    = %USER_CC_OPTIONS% %DEFAULT_DEFINE% %USER_DEFINES% $(INCLUDES_PATH)
# Assembler options
AS_SPEC_OPTS    = %USER_AS_OPTIONS% %DEFAULT_AS_DEFINE% %USER_AS_DEFINES% $(INCLUDES_PATH)
# Linker options
CC_LD_SPEC_OPTS = %USER_CC_LD_OPTIONS%

#-------------------------------------------------------------------------------
# Compiler, linker, assembler options
# default + specific options
#-------------------------------------------------------------------------------
CC_OPTS         = $(CC_DEF_OPTS) $(CC_SPEC_OPTS)
AS_OPTS         = $(AS_DEF_OPTS) $(AS_SPEC_OPTS)
CC_LD_OPTS      = $(CC_LD_DEF_OPTS) $(CC_LD_SPEC_OPTS)

#-------------------------------------------------------------------------------
# SRC_OBJS is the list of the project object files - updated by IngeDev
#-------------------------------------------------------------------------------
SRC_OBJS        = \
%USER_OBJECT_LIST%

<<if linkInterModuleByObj
#-------------------------------------------------------------------------------
# INTER_MOD_OBJS is the list of inter-module object files to be linked with
# the module - updated by IngeDev
#-------------------------------------------------------------------------------
INTER_MOD_OBJS = \
%INTER_MODULE_OBJS%
<<endif

#-------------------------------------------------------------------------------
# Dependencies - updated by IngeDev
#-------------------------------------------------------------------------------
DEPENDENCIES = \
$(CFG_PATH)/%MAKEFILE_FILE_NAME% \
$(VARS_MK_DEPENDENCY) \
$(OS_VARS_MK_DEPENDENCY) \
$(PROJECTS_VARS_MK_DEPENDENCIES)

<<if MainModule
#-------------------------------------------------------------------------------
# Added common module binaries dependencies - updated by IngeDev
#-------------------------------------------------------------------------------
ADDED_COM_MOD_DEPENDENCIES  = \
%ADDED_COM_MOD_DEPENDENCIES%
<<endif

#===============================================================================
# Rule to make the project - updated by IngeDev
#===============================================================================
<<if linkInterModuleByObj
$(DLL_FILE): $(SRC_OBJS) $(INTER_MOD_OBJS) $(LIBS)
<<else
$(DLL_FILE): $(SRC_OBJS) $(LIBS)
<<endif
	@$(PRINTF) "'$@' link in progress...\n"
<<if linkInterModuleByObj
	$(CC) $(CC_LD_OPTS) -o $@ $(SRC_OBJS) $(INTER_MOD_OBJS) -Wl,-\( $(LIBS) -Wl,-\)
<<else
	$(CC) $(CC_LD_OPTS) -o $@ $(SRC_OBJS) -Wl,-\( $(LIBS) -Wl,-\)
<<endif

ifeq "$(REMOVE_SYMBOLS)" "true"
	@$(PRINTF) "'$@' strip debug symbols in progress...\n"
	$(STRIP) $@ -o $(dir $@)/_$(notdir $@)
endif
	@$(PRINTF) "'$@' Win32 dll file generated.\n"

#===============================================================================
# Rule for the compilation process - updated by IngeDev
#===============================================================================
%COMPILER_FILES_RULES%
#===============================================================================
# Rule to display sub-project name and configuration name
#===============================================================================
.PHONY: displayInfo
displayInfo:
	@$(PRINTF) "                                     *-*-*\n"
	@$(PRINTF) "--- Project '$(PROJECT_NAME)', Sub-project '$(SUB_PRJ_NAME)', Configuration '$(CFG_NAME)' ---\n"

#===============================================================================
# Rule to create output directories if it not already exist
#===============================================================================
.PHONY: createOutputDirs
createOutputDirs:
	@$(MKDIR) "$(OBJ_PATH)"
	@$(MKDIR) "$(BIN_PATH)"

<<if MainModule
#===============================================================================
# Rule to copy added common modules DLL binaries to bin directory
# if existing added common modules - updated by IngeDev
#===============================================================================
copyAddedCommonModules:  $(ADDED_COM_MOD_DEPENDENCIES)
%ADDED_BIN_FILES%
<<endif
	
#===============================================================================
# Make build rule
#===============================================================================
.PHONY: build
<<if MainModule
build: displayInfo createOutputDirs copyAddedCommonModules $(DLL_FILE)
<<else
build: displayInfo createOutputDirs $(DLL_FILE)
<<endif
	@$(PRINTF) "done!\n"
	
#===============================================================================
# Make clean rule
#===============================================================================
.PHONY: clean
clean: displayInfo
	@$(PRINTF) "deleting intermediate files...\n"
	@$(RM) "$(DLL_FILE)"
<<if MainModule
%CLEAN_ADDED_BIN_FILES%
<<endif
ifneq "$(wildcard $(OBJ_PATH)/*.*)" ""
	@$(RM) "$(OBJ_PATH)/*.*"
endif
	@$(PRINTF) "done!\n"
